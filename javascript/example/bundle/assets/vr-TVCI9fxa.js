import{O as V,x as j,q as R,f as N,S as D,C as k,G as I,i as z,W as $,g as H,R as W,c as X,D as _,A as q,j as J,k as Y,p as K,U as Q,t as M,n as Z,y as ee,z as te,B as se,a as O,b as oe,I as ne,J as ie}from"./URDFLoader-BlOKAJT-.js";import{G,U as ae}from"./URDFDragControls-BpHxNhfn.js";class A{static createButton(e,t={}){const o=document.createElement("button");function r(){let s=null;async function w(x){x.addEventListener("end",g),await e.xr.setSession(x),o.textContent="EXIT VR",s=x}function g(){s.removeEventListener("end",g),o.textContent="ENTER VR",s=null}o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR";const P={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){s===null?navigator.xr.requestSession("immersive-vr",P).then(w):(s.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",P).then(w).catch(x=>{console.warn(x)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",P).then(w).catch(x=>{console.warn(x)})}function d(){o.style.display="",o.style.cursor="auto",o.style.left="calc(50% - 75px)",o.style.width="150px",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null}function l(){d(),o.textContent="VR NOT SUPPORTED"}function a(s){d(),console.warn("Exception when trying to call xr.isSessionSupported",s),o.textContent="VR NOT ALLOWED"}function n(s){s.style.position="absolute",s.style.bottom="20px",s.style.padding="12px 6px",s.style.border="1px solid #fff",s.style.borderRadius="4px",s.style.background="rgba(0,0,0,0.1)",s.style.color="#fff",s.style.font="normal 13px sans-serif",s.style.textAlign="center",s.style.opacity="0.5",s.style.outline="none",s.style.zIndex="999"}if("xr"in navigator)return o.id="VRButton",o.style.display="none",n(o),navigator.xr.isSessionSupported("immersive-vr").then(function(s){s?r():l(),s&&A.xrSessionIsGranted&&o.click()}).catch(a),o;{const s=document.createElement("a");return window.isSecureContext===!1?(s.href=document.location.href.replace(/^http:/,"https:"),s.innerHTML="WEBXR NEEDS HTTPS"):(s.href="https://immersiveweb.dev/",s.innerHTML="WEBXR NOT AVAILABLE"),s.style.left="calc(50% - 90px)",s.style.width="180px",s.style.textDecoration="none",n(s),s}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{A.xrSessionIsGranted=!0})}}}A.xrSessionIsGranted=!1;A.registerSessionGrantedListener();const u={ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function B(i){const e=await fetch(i);if(e.ok)return e.json();throw new Error(e.statusText)}async function re(i){if(!i)throw new Error("No basePath supplied");return await B(`${i}/profilesList.json`)}async function le(i,e,t=null,o=!0){if(!i)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await re(e);let d;if(i.profiles.some(n=>{const s=r[n];return s&&(d={profileId:n,profilePath:`${e}/${s.path}`,deprecated:!!s.deprecated}),!!d}),!d){if(!t)throw new Error("No matching profile name found");const n=r[t];if(!n)throw new Error(`No matching profile name found and default profile "${t}" missing.`);d={profileId:t,profilePath:`${e}/${n.path}`,deprecated:!!n.deprecated}}const l=await B(d.profilePath);let a;if(o){let n;if(i.handedness==="any"?n=l.layouts[Object.keys(l.layouts)[0]]:n=l.layouts[i.handedness],!n)throw new Error(`No matching handedness, ${i.handedness}, in profile ${d.profileId}`);n.assetPath&&(a=d.profilePath.replace("profile.json",n.assetPath))}return{profile:l,assetPath:a}}const de={xAxis:0,yAxis:0,button:0,state:u.ComponentState.DEFAULT};function ue(i=0,e=0){let t=i,o=e;if(Math.sqrt(i*i+e*e)>1){const l=Math.atan2(e,i);t=Math.cos(l),o=Math.sin(l)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:o*.5+.5}}class he{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===u.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(de)}updateFromComponent({xAxis:e,yAxis:t,button:o,state:r}){const{normalizedXAxis:d,normalizedYAxis:l}=ue(e,t);switch(this.componentProperty){case u.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?d:.5;break;case u.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?l:.5;break;case u.ComponentProperty.BUTTON:this.value=this.states.includes(r)?o:0;break;case u.ComponentProperty.STATE:this.valueNodeProperty===u.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class ce{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(o=>{const r=new he(t.visualResponses[o]);this.visualResponses[o]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:u.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=u.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=u.ComponentState.PRESSED:(t.touched||this.values.button>u.ButtonTouchThreshold)&&(this.values.state=u.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===u.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>u.AxisTouchThreshold&&(this.values.state=u.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===u.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>u.AxisTouchThreshold&&(this.values.state=u.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class pe{constructor(e,t,o){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=o,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const d=this.layoutDescription.components[r];this.components[r]=new ce(r,d)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const fe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",me="generic-trigger";class ve extends V{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(o=>{const{valueNode:r,minNode:d,maxNode:l,value:a,valueNodeProperty:n}=o;r&&(n===u.VisualResponseProperty.VISIBILITY?r.visible=a:n===u.VisualResponseProperty.TRANSFORM&&(r.quaternion.slerpQuaternions(d.quaternion,l.quaternion,a),r.position.lerpVectors(d.position,l.position,a)))})}))}}function xe(i,e){Object.values(i.components).forEach(t=>{const{type:o,touchPointNodeName:r,visualResponses:d}=t;if(o===u.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){const l=new j(.001),a=new R({color:255}),n=new N(l,a);t.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(d).forEach(l=>{const{valueNodeName:a,minNodeName:n,maxNodeName:s,valueNodeProperty:w}=l;if(w===u.VisualResponseProperty.TRANSFORM){if(l.minNode=e.getObjectByName(n),l.maxNode=e.getObjectByName(s),!l.minNode){console.warn(`Could not find ${n} in the model`);return}if(!l.maxNode){console.warn(`Could not find ${s} in the model`);return}}l.valueNode=e.getObjectByName(a),l.valueNode||console.warn(`Could not find ${a} in the model`)})})}function F(i,e){xe(i.motionController,e),i.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=i.envMap,t.material.needsUpdate=!0)}),i.add(e)}class ye{constructor(e=null,t=null){this.gltfLoader=e,this.path=fe,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new G)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new ve;let o=null;return e.addEventListener("connected",r=>{const d=r.data;d.targetRayMode!=="tracked-pointer"||!d.gamepad||le(d,this.path,me).then(({profile:l,assetPath:a})=>{t.motionController=new pe(d,l,a);const n=this._assetCache[t.motionController.assetUrl];if(n)o=n.scene.clone(),F(t,o),this.onLoad&&this.onLoad(o);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,s=>{this._assetCache[t.motionController.assetUrl]=s,o=s.scene.clone(),F(t,o),this.onLoad&&this.onLoad(o)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(l=>{console.warn(l)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(o),o=null}),t}}let m,C,c,f,y,p,T,E,L,h,b,v,S;we();function we(){m=new D,m.background=new k(16755520),L=new I,m.add(L),y=new I,y.position.z=3,m.add(y),C=new z,y.add(C),c=new $({antialias:!0}),c.shadowMap.enabled=!0,c.shadowMap.type=H,document.body.appendChild(c.domElement),E=new W;const i=new X({emissive:16755520,emissiveIntensity:.25});h=new ae(L),h.onHover=a=>{const n=s=>{s!==a&&s.isURDFJoint&&s.jointType!=="fixed"||(s.isMesh&&(s.__originalMaterial=s.material,s.material=i),s.children.forEach(n))};n(a)},h.onUnhover=a=>{const n=s=>{s!==a&&s.isURDFJoint&&s.jointType!=="fixed"||(s.isMesh&&(s.material=s.__originalMaterial),s.children.forEach(n))};n(a)},c.xr.enabled=!0,c.setAnimationLoop(be),document.body.appendChild(A.createButton(c));const e=new _(16777215,3);e.castShadow=!0,e.shadow.mapSize.setScalar(2048),e.position.set(5,30,5),m.add(e);const t=new q(16758605,1);m.add(t),b=new N(new J,new Y({opacity:.1})),b.rotation.x=-Math.PI/2,b.scale.setScalar(30),b.receiveShadow=!0,m.add(b);const o=new K,r=new Q(o);r.loadMeshCb=function(a,n,s){switch(a.split(/\./g).pop().toLowerCase()){case"gltf":new G(n).load(a,g=>s(g.scene),null,g=>s(null,g));break;default:r.defaultMeshLoader(a,n,s)}},r.load("../../../urdf/T12/urdf/T12_flipped.URDF",a=>{f=a}),o.onLoad=function(){f.rotation.x=Math.PI/2,f.traverse(n=>{n.castShadow=!0,n.receiveShadow=!0});for(let n=1;n<=6;n++)f.joints[`HP${n}`].setJointValue(M.degToRad(30)),f.joints[`KP${n}`].setJointValue(M.degToRad(120)),f.joints[`AP${n}`].setJointValue(M.degToRad(-60));f.updateMatrixWorld(!0);const a=new Z;a.setFromObject(f),f.position.y-=a.min.y,L.add(f)};const d=new R({color:16777215});v=new N(new ee(.25,.02,16,100),d),v.rotation.x=Math.PI/2,v.visible=!1,m.add(v),S=new N(new j(.01,50,50),d),m.add(S),p=c.xr.getController(0),p.addEventListener("selectstart",()=>{h.setGrabbed(!0),!h.hovered&&!h.manipulating&&v.visible&&y.position.copy(v.position)}),p.addEventListener("selectend",()=>{h.setGrabbed(!1)}),p.addEventListener("connected",function(a){this.controllerActive=!0,this.add(ge(a.data))}),p.addEventListener("disconnected",function(){this.controllerActive=!1,this.remove(this.children[0])}),y.add(p);const l=new ye;T=c.xr.getControllerGrip(0),T.add(l.createControllerModel(T)),y.add(T),U(),window.addEventListener("resize",U)}function ge(i){let e,t;switch(i.targetRayMode){case"tracked-pointer":return e=new se,e.setAttribute("position",new O([0,0,0,0,0,-1],3)),e.setAttribute("color",new O([.5,.5,.5,0,0,0],3)),t=new oe({vertexColors:!0,blending:ne,depthWrite:!1,transparent:!0}),new ie(e,t);case"gaze":return e=new te(.02,.04,32).translate(0,0,-1),t=new R({opacity:.5,transparent:!0}),new N(e,t)}}function U(){c.setSize(window.innerWidth,window.innerHeight),c.setPixelRatio(window.devicePixelRatio),C.aspect=window.innerWidth/window.innerHeight,C.updateProjectionMatrix()}function be(){if(E.origin.set(0,0,0).applyMatrix4(p.matrixWorld),E.direction.set(0,0,-1).transformDirection(p.matrixWorld),h.moveRay(E),!h.hovered&&!h.manipulating){const i=h.raycaster.intersectObject(b)[0];S.visible=!1,i?(v.position.copy(i.point),v.visible=!0):v.visible=!1,p.children[0]&&p.children[0].scale.setScalar(1)}else p.children[0]&&p.children[0].scale.setScalar(h.hitDistance),E.at(h.hitDistance,S.position),S.visible=!0,v.visible=!1;c.render(m,C)}
//# sourceMappingURL=vr-TVCI9fxa.js.map
