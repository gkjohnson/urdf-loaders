import{L as re,F as ae,C as q,G as le,B as H,a as x,b as R,M as N,P as S,c as k,d as W,e as U,f as I,V as M,S as ce,H as de,D as he,W as ue,g as pe,h as Z,i as me,O as fe,j as ge,k as be,l as ve,m as we,n as ye,o as Le,p as Ee,U as Ce,q as Ae,r as xe,s as je,t as _}from"./URDFLoader-BlOKAJT-.js";import{P as Me,G as _e}from"./URDFDragControls-BpHxNhfn.js";import{O as Ve}from"./OrbitControls-Dee3VBUL.js";function ke(a){if(!(a instanceof DataTransfer))throw new Error('Data must be of type "DataTransfer"',a);const e={};function t(i){if(i.isFile)return new Promise(s=>{i.file(n=>{e[i.fullPath]=n,s()})});{const s=i.createReader();return new Promise(n=>{const o=[];function c(){s.readEntries(d=>{d.length===0?Promise.all(o).then(()=>n()):(d.forEach(r=>{o.push(t(r))}),c())})}c()})}}return new Promise(i=>{const s=a.items&&[...a.items],n=[...a.files];if(s&&s.length&&s[0].webkitGetAsEntry){const o=[];for(let c=0;c<s.length;c++){const r=s[c].webkitGetAsEntry();o.push(t(r))}Promise.all(o).then(()=>i(e))}else n.filter(o=>o.size!==0).forEach(o=>e["/"+o.name]=o),i(e)})}function Se(a,e){document.addEventListener("dragover",t=>t.preventDefault()),document.addEventListener("dragenter",t=>t.preventDefault()),document.addEventListener("drop",t=>{t.preventDefault(),ke(t.dataTransfer).then(i=>{const s=r=>r.replace(/\\/g,"/").split(/\//g).reduce((h,l)=>(l===".."?h.pop():l!=="."&&h.push(l),h),[]).join("/"),n=Object.keys(i).map(r=>s(r));a.urlModifierFunc=r=>{const h=s(r.replace(a.package,"")),l=n.filter(p=>{const m=Math.min(p.length,h.length);return h.substr(h.length-m)===p.substr(p.length-m)}).pop();if(l!==void 0){const p=URL.createObjectURL(i[l]);return requestAnimationFrame(()=>URL.revokeObjectURL(p)),p}return r};const o=Object.keys(i);a.up="+Z",document.getElementById("up-select").value=a.up;const c=n.filter(r=>/urdf$/i.test(r)),d=document.querySelector("#urdf-options");for(;d.firstChild;)d.removeChild(d.firstChild);c.forEach(r=>{const h=document.createElement("li");h.setAttribute("urdf",r),h.setAttribute("color","#263238"),h.textContent=r.split(/[\\\/]/).pop(),d.appendChild(h)}),a.urdf=o.filter(r=>/urdf$/i.test(r)).shift()}).then(()=>e())})}const Fe=/^[og]\s*(.+)?/,Ie=/^mtllib /,Pe=/^usemtl /,De=/^usemap /,X=/\s+/,Y=new M,z=new M,K=new M,Q=new M,L=new M,F=new q;function Re(){const a={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,n){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const c={index:this.materials.length,name:s||"",mtllib:Array.isArray(n)&&n.length>0?n[n.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(d){const r={index:typeof d=="number"?d:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return r.clone=this.clone.bind(r),r}};return this.materials.push(c),c},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const n=this.currentMaterial();if(n&&n.groupEnd===-1&&(n.groupEnd=this.geometry.vertices.length/3,n.groupCount=n.groupEnd-n.groupStart,n.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),n}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const s=this.vertices,n=this.object.geometry.vertices;n.push(s[e+0],s[e+1],s[e+2]),n.push(s[t+0],s[t+1],s[t+2]),n.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const s=this.normals,n=this.object.geometry.normals;n.push(s[e+0],s[e+1],s[e+2]),n.push(s[t+0],s[t+1],s[t+2]),n.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(e,t,i){const s=this.vertices,n=this.object.geometry.normals;Y.fromArray(s,e),z.fromArray(s,t),K.fromArray(s,i),L.subVectors(K,z),Q.subVectors(Y,z),L.cross(Q),L.normalize(),n.push(L.x,L.y,L.z),n.push(L.x,L.y,L.z),n.push(L.x,L.y,L.z)},addColor:function(e,t,i){const s=this.colors,n=this.object.geometry.colors;s[e]!==void 0&&n.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&n.push(s[t+0],s[t+1],s[t+2]),s[i]!==void 0&&n.push(s[i+0],s[i+1],s[i+2])},addUV:function(e,t,i){const s=this.uvs,n=this.object.geometry.uvs;n.push(s[e+0],s[e+1]),n.push(s[t+0],s[t+1]),n.push(s[i+0],s[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,s,n,o,c,d,r){const h=this.vertices.length;let l=this.parseVertexIndex(e,h),p=this.parseVertexIndex(t,h),m=this.parseVertexIndex(i,h);if(this.addVertex(l,p,m),this.addColor(l,p,m),c!==void 0&&c!==""){const b=this.normals.length;l=this.parseNormalIndex(c,b),p=this.parseNormalIndex(d,b),m=this.parseNormalIndex(r,b),this.addNormal(l,p,m)}else this.addFaceNormal(l,p,m);if(s!==void 0&&s!==""){const b=this.uvs.length;l=this.parseUVIndex(s,b),p=this.parseUVIndex(n,b),m=this.parseUVIndex(o,b),this.addUV(l,p,m),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,s=e.length;i<s;i++){const n=this.parseVertexIndex(e[i],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));for(let n=0,o=t.length;n<o;n++)this.addUVLine(this.parseUVIndex(t[n],s))}};return a.startObject("",!1),a}class Ue extends re{constructor(e){super(e),this.materials=null}load(e,t,i,s){const n=this,o=new ae(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{t(n.parse(c))}catch(d){s?s(d):console.error(d),n.manager.itemError(e)}},i,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Re;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let s=[];for(let c=0,d=i.length;c<d;c++){const r=i[c].trimStart();if(r.length===0)continue;const h=r.charAt(0);if(h!=="#")if(h==="v"){const l=r.split(X);switch(l[0]){case"v":t.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),l.length>=7?(F.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6])).convertSRGBToLinear(),t.colors.push(F.r,F.g,F.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":t.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(h==="f"){const p=r.slice(1).trim().split(X),m=[];for(let f=0,v=p.length;f<v;f++){const w=p[f];if(w.length>0){const y=w.split("/");m.push(y)}}const b=m[0];for(let f=1,v=m.length-1;f<v;f++){const w=m[f],y=m[f+1];t.addFace(b[0],w[0],y[0],b[1],w[1],y[1],b[2],w[2],y[2])}}else if(h==="l"){const l=r.substring(1).trim().split(" ");let p=[];const m=[];if(r.indexOf("/")===-1)p=l;else for(let b=0,f=l.length;b<f;b++){const v=l[b].split("/");v[0]!==""&&p.push(v[0]),v[1]!==""&&m.push(v[1])}t.addLineGeometry(p,m)}else if(h==="p"){const p=r.slice(1).trim().split(" ");t.addPointGeometry(p)}else if((s=Fe.exec(r))!==null){const l=(" "+s[0].slice(1).trim()).slice(1);t.startObject(l)}else if(Pe.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(Ie.test(r))t.materialLibraries.push(r.substring(7).trim());else if(De.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(s=r.split(" "),s.length>1){const p=s[1].trim().toLowerCase();t.object.smooth=p!=="0"&&p!=="off"}else t.object.smooth=!0;const l=t.object.currentMaterial();l&&(l.smooth=t.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}}t.finalize();const n=new le;if(n.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let c=0,d=t.objects.length;c<d;c++){const r=t.objects[c],h=r.geometry,l=r.materials,p=h.type==="Line",m=h.type==="Points";let b=!1;if(h.vertices.length===0)continue;const f=new H;f.setAttribute("position",new x(h.vertices,3)),h.normals.length>0&&f.setAttribute("normal",new x(h.normals,3)),h.colors.length>0&&(b=!0,f.setAttribute("color",new x(h.colors,3))),h.hasUVIndices===!0&&f.setAttribute("uv",new x(h.uvs,2));const v=[];for(let y=0,D=l.length;y<D;y++){const E=l[y],$=E.name+"_"+E.smooth+"_"+b;let g=t.materials[$];if(this.materials!==null){if(g=this.materials.create(E.name),p&&g&&!(g instanceof R)){const C=new R;N.prototype.copy.call(C,g),C.color.copy(g.color),g=C}else if(m&&g&&!(g instanceof S)){const C=new S({size:10,sizeAttenuation:!1});N.prototype.copy.call(C,g),C.color.copy(g.color),C.map=g.map,g=C}}g===void 0&&(p?g=new R:m?g=new S({size:1,sizeAttenuation:!1}):g=new k,g.name=E.name,g.flatShading=!E.smooth,g.vertexColors=b,t.materials[$]=g),v.push(g)}let w;if(v.length>1){for(let y=0,D=l.length;y<D;y++){const E=l[y];f.addGroup(E.groupStart,E.groupCount,y)}p?w=new W(f,v):m?w=new U(f,v):w=new I(f,v)}else p?w=new W(f,v[0]):m?w=new U(f,v[0]):w=new I(f,v[0]);w.name=r.name,n.add(w)}else if(t.vertices.length>0){const c=new S({size:1,sizeAttenuation:!1}),d=new H;d.setAttribute("position",new x(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(d.setAttribute("color",new x(t.colors,3)),c.vertexColors=!0);const r=new U(d,c);n.add(r)}return n}}const ze=new we,Be=()=>{};class Oe extends HTMLElement{static get observedAttributes(){return["package","urdf","up","display-shadow","ambient-color","ignore-limits","show-collision"]}get package(){return this.getAttribute("package")||""}set package(e){this.setAttribute("package",e)}get urdf(){return this.getAttribute("urdf")||""}set urdf(e){this.setAttribute("urdf",e)}get ignoreLimits(){return this.hasAttribute("ignore-limits")||!1}set ignoreLimits(e){e?this.setAttribute("ignore-limits",e):this.removeAttribute("ignore-limits")}get up(){return this.getAttribute("up")||"+Z"}set up(e){this.setAttribute("up",e)}get displayShadow(){return this.hasAttribute("display-shadow")||!1}set displayShadow(e){e?this.setAttribute("display-shadow",""):this.removeAttribute("display-shadow")}get ambientColor(){return this.getAttribute("ambient-color")||"#8ea0a8"}set ambientColor(e){e?this.setAttribute("ambient-color",e):this.removeAttribute("ambient-color")}get autoRedraw(){return this.hasAttribute("auto-redraw")||!1}set autoRedraw(e){e?this.setAttribute("auto-redraw",!0):this.removeAttribute("auto-redraw")}get noAutoRecenter(){return this.hasAttribute("no-auto-recenter")||!1}set noAutoRecenter(e){e?this.setAttribute("no-auto-recenter",!0):this.removeAttribute("no-auto-recenter")}get showCollision(){return this.hasAttribute("show-collision")||!1}set showCollision(e){e?this.setAttribute("show-collision",!0):this.removeAttribute("show-collision")}get jointValues(){const e={};if(this.robot)for(const t in this.robot.joints){const i=this.robot.joints[t];e[t]=i.jointValue.length===1?i.angle:[...i.jointValue]}return e}set jointValues(e){this.setJointValues(e)}get angles(){return this.jointValues}set angles(e){this.jointValues=e}constructor(){super(),this._requestId=0,this._dirty=!1,this._loadScheduled=!1,this.robot=null,this.loadMeshFunc=null,this.urlModifierFunc=null;const e=new ce,t=new de(this.ambientColor,"#000");t.groundColor.lerp(t.color,.5*Math.PI),t.intensity=.5,t.position.set(0,1,0),e.add(t);const i=new he(16777215,Math.PI);i.position.set(4,10,1),i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048,i.shadow.normalBias=.001,i.castShadow=!0,e.add(i),e.add(i.target);const s=new ue({antialias:!0,alpha:!0});s.setClearColor(16777215),s.setClearAlpha(0),s.shadowMap.enabled=!0,s.shadowMap.type=pe,s.outputColorSpace=Z;const n=new me(75,1,.1,1e3);n.position.z=-10;const o=new fe;e.add(o);const c=new I(new ge(40,40),new be({side:ve,transparent:!0,opacity:.25}));c.rotation.x=-Math.PI/2,c.position.y=-.5,c.receiveShadow=!0,c.scale.set(10,10,10),e.add(c);const d=new Ve(n,s.domElement);d.rotateSpeed=2,d.zoomSpeed=5,d.panSpeed=2,d.enableZoom=!0,d.enableDamping=!1,d.maxDistance=50,d.minDistance=.25,d.addEventListener("change",()=>this.recenter()),this.scene=e,this.world=o,this.renderer=s,this.camera=n,this.controls=d,this.plane=c,this.directionalLight=i,this.ambientLight=t,this._setUp(this.up),this._collisionMaterial=new k({transparent:!0,opacity:.35,shininess:2.5,premultipliedAlpha:!0,color:16760376,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1});const r=()=>{this.parentNode&&(this.updateSize(),(this._dirty||this.autoRedraw)&&(this.noAutoRecenter||this._updateEnvironment(),this.renderer.render(e,n),this._dirty=!1),this.controls.update()),this._renderLoopId=requestAnimationFrame(r)};r()}connectedCallback(){if(!this.constructor._styletag){const e=document.createElement("style");e.innerHTML=`
                ${this.tagName} { display: block; }
                ${this.tagName} canvas {
                    width: 100%;
                    height: 100%;
                }
            `,document.head.appendChild(e),this.constructor._styletag=e}this.childElementCount===0&&this.appendChild(this.renderer.domElement),this.updateSize(),requestAnimationFrame(()=>this.updateSize())}disconnectedCallback(){cancelAnimationFrame(this._renderLoopId)}attributeChangedCallback(e,t,i){switch(this._updateCollisionVisibility(),this.noAutoRecenter||this.recenter(),e){case"package":case"urdf":{this._scheduleLoad();break}case"up":{this._setUp(this.up);break}case"ambient-color":{this.ambientLight.color.set(this.ambientColor),this.ambientLight.groundColor.set("#000").lerp(this.ambientLight.color,.5);break}case"ignore-limits":{this._setIgnoreLimits(this.ignoreLimits,!0);break}}}updateSize(){const e=this.renderer,t=this.clientWidth,i=this.clientHeight,s=e.getSize(ze);(s.width!==t||s.height!==i)&&this.recenter(),e.setPixelRatio(window.devicePixelRatio),e.setSize(t,i,!1),this.camera.aspect=t/i,this.camera.updateProjectionMatrix()}redraw(){this._dirty=!0}recenter(){this._updateEnvironment(),this.redraw()}setJointValue(e,...t){this.robot&&this.robot.joints[e]&&this.robot.joints[e].setJointValue(...t)&&(this.redraw(),this.dispatchEvent(new CustomEvent("angle-change",{bubbles:!0,cancelable:!0,detail:e})))}setJointValues(e){for(const t in e)Array.isArray(e[t])?this.setJointValue(t,...e[t]):this.setJointValue(t,e[t])}_updateEnvironment(){const e=this.robot;if(!e)return;this.world.updateMatrixWorld();const t=new ye;t.makeEmpty(),e.traverse(n=>{n.isURDFVisual&&t.expandByObject(n)});const i=t.getCenter(new M);this.controls.target.y=i.y,this.plane.position.y=t.min.y-.001;const s=this.directionalLight;if(s.castShadow=this.displayShadow,this.displayShadow){const o=t.getBoundingSphere(new Le).radius,c=s.shadow.camera;c.left=c.bottom=-o,c.right=c.top=o;const d=s.position.clone().sub(s.target.position);s.target.position.copy(i),s.position.copy(i).add(d),c.updateProjectionMatrix()}}_scheduleLoad(){this._prevload!==`${this.package}|${this.urdf}`&&(this._prevload=`${this.package}|${this.urdf}`,!this._loadScheduled&&(this._loadScheduled=!0,this.robot&&(this.robot.traverse(e=>e.dispose&&e.dispose()),this.robot.parent.remove(this.robot),this.robot=null),requestAnimationFrame(()=>{this._loadUrdf(this.package,this.urdf),this._loadScheduled=!1})))}_loadUrdf(e,t){if(this.dispatchEvent(new CustomEvent("urdf-change",{bubbles:!0,cancelable:!0,composed:!0})),t){this._requestId++;const i=this._requestId,s=d=>{d.traverse(r=>{if(r.isMesh&&(r.castShadow=!0,r.receiveShadow=!0,r.material)){const h=(Array.isArray(r.material)?r.material:[r.material]).map(l=>(l instanceof Ae&&(l=new k),l.map&&(l.map.colorSpace=Z),l));r.material=h.length===1?h[0]:h}})};e.includes(":")&&e.split(":")[1].substring(0,2)!=="//"&&(e=e.split(",").reduce((d,r)=>{const h=r.split(/:/).filter(m=>!!m),l=h.shift().trim(),p=h.join(":").trim();return d[l]=p,d},{}));let n=null;const o=new Ee;o.onLoad=()=>{if(this._requestId!==i){n.traverse(d=>d.dispose&&d.dispose());return}this.robot=n,this.world.add(n),s(n),this._setIgnoreLimits(this.ignoreLimits),this._updateCollisionVisibility(),this.dispatchEvent(new CustomEvent("urdf-processed",{bubbles:!0,cancelable:!0,composed:!0})),this.dispatchEvent(new CustomEvent("geometry-loaded",{bubbles:!0,cancelable:!0,composed:!0})),this.recenter()},this.urlModifierFunc&&o.setURLModifier(this.urlModifierFunc);const c=new Ce(o);c.packages=e,c.loadMeshCb=this.loadMeshFunc,c.fetchOptions={mode:"cors",credentials:"same-origin"},c.parseCollision=!0,c.load(t,d=>n=d)}}_updateCollisionVisibility(){const e=this.showCollision,t=this._collisionMaterial,i=this.robot;if(i===null)return;const s=[];i.traverse(n=>{n.isURDFCollider&&(n.visible=e,s.push(n))}),s.forEach(n=>{n.traverse(o=>{o.isMesh&&(o.raycast=Be,o.material=t,o.castShadow=!1)})})}_setUp(e){e||(e="+Z"),e=e.toUpperCase();const t=e.replace(/[^-+]/g,"")[0]||"+",i=e.replace(/[^XYZ]/gi,"")[0]||"Z",s=Math.PI,n=s/2;i==="X"&&this.world.rotation.set(0,0,t==="+"?n:-n),i==="Z"&&this.world.rotation.set(t==="+"?-n:n,0,0),i==="Y"&&this.world.rotation.set(t==="+"?0:s,0,0)}_setIgnoreLimits(e,t=!1){this.robot&&Object.values(this.robot.joints).forEach(i=>{i.ignoreLimits=e,i.setJointValue(...i.jointValue)}),t&&this.dispatchEvent(new CustomEvent("ignore-limits-change",{bubbles:!0,cancelable:!0,composed:!0}))}}class Te extends Oe{static get observedAttributes(){return["highlight-color",...super.observedAttributes]}get disableDragging(){return this.hasAttribute("disable-dragging")}set disableDragging(e){e?this.setAttribute("disable-dragging",!!e):this.removeAttribute("disable-dragging")}get highlightColor(){return this.getAttribute("highlight-color")||"#FFFFFF"}set highlightColor(e){e?this.setAttribute("highlight-color",e):this.removeAttribute("highlight-color")}constructor(...e){super(...e),this.highlightMaterial=new k({shininess:10,color:this.highlightColor,emissive:this.highlightColor,emissiveIntensity:.25});const t=o=>o.isURDFJoint&&o.jointType!=="fixed",i=(o,c)=>{const d=r=>{if(r.type==="Mesh"&&(c?(r.material=r.__origMaterial,delete r.__origMaterial):(r.__origMaterial=r.material,r.material=this.highlightMaterial)),r===o||!t(r))for(let h=0;h<r.children.length;h++)r.children[h].isURDFCollider||d(r.children[h])};d(o)},s=this.renderer.domElement,n=new Me(this.scene,this.camera,s);n.onDragStart=o=>{this.dispatchEvent(new CustomEvent("manipulate-start",{bubbles:!0,cancelable:!0,detail:o.name})),this.controls.enabled=!1,this.redraw()},n.onDragEnd=o=>{this.dispatchEvent(new CustomEvent("manipulate-end",{bubbles:!0,cancelable:!0,detail:o.name})),this.controls.enabled=!0,this.redraw()},n.updateJoint=(o,c)=>{this.setJointValue(o.name,c)},n.onHover=o=>{i(o,!1),this.dispatchEvent(new CustomEvent("joint-mouseover",{bubbles:!0,cancelable:!0,detail:o.name})),this.redraw()},n.onUnhover=o=>{i(o,!0),this.dispatchEvent(new CustomEvent("joint-mouseout",{bubbles:!0,cancelable:!0,detail:o.name})),this.redraw()},this.dragControls=n}disconnectedCallback(){super.disconnectedCallback(),this.dragControls.dispose()}attributeChangedCallback(e,t,i){switch(super.attributeChangedCallback(e,t,i),e){case"highlight-color":this.highlightMaterial.color.set(this.highlightColor),this.highlightMaterial.emissive.set(this.highlightColor);break}}}customElements.define("urdf-viewer",Te);const u=document.querySelector("urdf-viewer"),B=document.getElementById("ignore-joint-limits"),O=document.getElementById("collision-toggle"),P=document.getElementById("radians-toggle"),T=document.getElementById("autocenter-toggle"),ee=document.getElementById("up-select"),Je=document.querySelector("#controls ul"),G=document.getElementById("controls"),qe=document.getElementById("toggle-controls"),j=document.getElementById("do-animate"),J=document.getElementById("hide-fixed"),V=Math.PI/180,Ge=1/V;let A={};const te=a=>{document.body.style.backgroundColor=a,u.highlightColor="#"+new q(16777215).lerp(new q(a),.35).getHexString()};B.addEventListener("click",()=>{B.classList.toggle("checked"),u.ignoreLimits=B.classList.contains("checked")});P.addEventListener("click",()=>{P.classList.toggle("checked"),Object.values(A).forEach(a=>a.update())});O.addEventListener("click",()=>{O.classList.toggle("checked"),u.showCollision=O.classList.contains("checked")});T.addEventListener("click",()=>{T.classList.toggle("checked"),u.noAutoRecenter=!T.classList.contains("checked")});J.addEventListener("click",()=>{J.classList.toggle("checked"),J.classList.contains("checked")?G.classList.add("hide-fixed"):G.classList.remove("hide-fixed")});ee.addEventListener("change",()=>u.up=ee.value);qe.addEventListener("click",()=>G.classList.toggle("hidden"));u.addEventListener("urdf-change",()=>{Object.values(A).forEach(a=>a.remove()),A={}});u.addEventListener("ignore-limits-change",()=>{Object.values(A).forEach(a=>a.update())});u.addEventListener("angle-change",a=>{A[a.detail]&&A[a.detail].update()});u.addEventListener("joint-mouseover",a=>{const e=document.querySelector(`li[joint-name="${a.detail}"]`);e&&e.setAttribute("robot-hovered",!0)});u.addEventListener("joint-mouseout",a=>{const e=document.querySelector(`li[joint-name="${a.detail}"]`);e&&e.removeAttribute("robot-hovered")});let se;u.addEventListener("manipulate-start",a=>{const e=document.querySelector(`li[joint-name="${a.detail}"]`);e&&(e.scrollIntoView({block:"nearest"}),window.scrollTo(0,0)),se=u.noAutoRecenter,u.noAutoRecenter=!0});u.addEventListener("manipulate-end",a=>{u.noAutoRecenter=se});u.addEventListener("urdf-processed",()=>{const a=u.robot;Object.keys(a.joints).sort((e,t)=>{const i=e.split(/[^\d]+/g).filter(n=>!!n).pop(),s=t.split(/[^\d]+/g).filter(n=>!!n).pop();if(i!==void 0&&s!==void 0){const n=parseFloat(i)-parseFloat(s);if(n!==0)return n}return e>t?1:t>e?-1:0}).map(e=>a.joints[e]).forEach(e=>{const t=document.createElement("li");t.innerHTML=`
            <span title="${e.name}">${e.name}</span>
            <input type="range" value="0" step="0.0001"/>
            <input type="number" step="0.0001" />
            `,t.setAttribute("joint-type",e.jointType),t.setAttribute("joint-name",e.name),Je.appendChild(t);const i=t.querySelector('input[type="range"]'),s=t.querySelector('input[type="number"]');switch(t.update=()=>{const n=P.classList.contains("checked")?1:Ge;let o=e.angle;(e.jointType==="revolute"||e.jointType==="continuous")&&(o*=n),Math.abs(o)>1?o=o.toFixed(1):o=o.toPrecision(2),s.value=parseFloat(o),i.value=e.angle,u.ignoreLimits||e.jointType==="continuous"?(i.min=-6.28,i.max=6.28,s.min=-6.28*n,s.max=6.28*n):(i.min=e.limit.lower,i.max=e.limit.upper,s.min=e.limit.lower*n,s.max=e.limit.upper*n)},e.jointType){case"continuous":case"prismatic":case"revolute":break;default:t.update=()=>{},s.remove(),i.remove()}i.addEventListener("input",()=>{u.setJointValue(e.name,i.value),t.update()}),s.addEventListener("change",()=>{const n=P.classList.contains("checked")?1:V;u.setJointValue(e.name,s.value*n),t.update()}),t.update(),A[e.name]=t})});document.addEventListener("WebComponentsReady",()=>{u.loadMeshFunc=(a,e,t)=>{switch(a.split(/\./g).pop().toLowerCase()){case"gltf":case"glb":new _e(e).load(a,s=>t(s.scene),null,s=>t(null,s));break;case"obj":new Ue(e).load(a,s=>t(s),null,s=>t(null,s));break;case"dae":new je(e).load(a,s=>t(s.scene),null,s=>t(null,s));break;case"stl":new xe(e).load(a,s=>{const n=new k,o=new I(s,n);t(o)},null,s=>t(null,s));break}},document.querySelector("li[urdf]").dispatchEvent(new Event("click")),/javascript\/example\/bundle/i.test(window.location)&&(u.package="../../../urdf"),Se(u,()=>{te("#263238"),j.classList.remove("checked"),oe()})});const ie=()=>{if(!u.setJointValue)return;const a=u.angles;for(const t in a)Array.isArray(a[t])?a[t].fill(0):a[t]=0;u.setJointValues(a);const e=Date.now()/300;for(let t=1;t<=6;t++){const i=t*Math.PI/3,s=Math.max(0,Math.sin(e+i));u.setJointValue(`HP${t}`,_.lerp(30,0,s)*V),u.setJointValue(`KP${t}`,_.lerp(90,150,s)*V),u.setJointValue(`AP${t}`,_.lerp(-30,-60,s)*V),u.setJointValue(`TC${t}A`,_.lerp(0,.065,s)),u.setJointValue(`TC${t}B`,_.lerp(0,.065,s)),u.setJointValue(`W${t}`,window.performance.now()*.001)}},ne=()=>{j.classList.contains("checked")&&ie(),requestAnimationFrame(ne)},oe=()=>{document.querySelectorAll("#urdf-options li[urdf]").forEach(a=>{a.addEventListener("click",e=>{const t=e.target.getAttribute("urdf"),i=e.target.getAttribute("color");u.up="-Z",document.getElementById("up-select").value=u.up,u.urdf=t,j.classList.add("checked"),te(i)})})};oe();document.addEventListener("WebComponentsReady",()=>{j.addEventListener("click",()=>j.classList.toggle("checked")),u.addEventListener("manipulate-start",a=>j.classList.remove("checked")),u.addEventListener("urdf-processed",a=>ie()),ne(),u.camera.position.set(-5.5,3.5,5.5)});
//# sourceMappingURL=index-BmeHgwPw.js.map
